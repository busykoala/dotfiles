echo "\n--> Get package name\n"
PKG_NAME=$(cat setup.py | grep name= | cut -d\' -f2)
echo "\n--> Found package name: ${PKG_NAME}\n"

echo "\n--> Activate venv\n"
workon plone_init

echo "\n--> Copy busykoala_buildout.cfg to project\n"
cp -f ~/dotfiles/examples/busykoala_buildout.cfg busykoala_buildout.cfg

echo "\n--> Replacing PACKAGE_NAME with ${PKG_NAME}\n"
sed -i '' "s/PACKAGE_NAME/$PKG_NAME/g" busykoala_buildout.cfg

echo "\n--> Symlink busykoala_buildout.cfg\n"
ln -fs busykoala_buildout.cfg buildout.cfg

echo "\n--> Bootstrap app\n"
python bootstrap.py

echo "\n--> Deactivate venv\n"
deactivate

echo "\n--> Run buildout\n"
bin/buildout

if [ -d "./parts/real_omelette" ]; then
  echo "\n--> Delete old real_omelette\n"
  rm -rf ./parts/real_omelette
fi
if [ -d "./parts/omelette" ]; then
  echo "\n--> Add new real_omelette\n"
  cp -RL ./parts/omelette ./parts/real_omelette
fi
