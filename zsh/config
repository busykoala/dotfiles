# check time with: /usr/bin/time zsh -i -c exit
autoload -U promptinit colors && colors
promptinit

# set prompt theme
prompt walters
PS1='%u%{$reset_color%}$(git_branch_prompt)%{$fg[blue]%}%%>%{$reset_color%} '
setopt promptsubst

# load functions
fpath=($fpath ~/dotfiles/zsh/functions $fpath)
autoload -U ~/dotfiles/zsh/functions/*(:t)

#change directory without cd
setopt autocd

# stty config
stty icrnl

# HISTORY
HISTSIZE=3000
SAVEHIST=3000
HISTFILE=~/.zsh_history
bindkey "^[[A" history-beginning-search-backward
bindkey "^[[B" history-beginning-search-forward

# use the vi navigation keys in menu completion
zstyle ':completion:*' menu select
zmodload zsh/complist
bindkey -M menuselect 'h' vi-backward-char
bindkey -M menuselect 'k' vi-up-line-or-history
bindkey -M menuselect 'l' vi-forward-char
bindkey -M menuselect 'j' vi-down-line-or-history

# bind delete key to delete key :)
bindkey "\e[3~" delete-char

# exports
export PATH=/usr/local/bin:/Users/busykoala/bin:$PATH
export LC_CTYPE=en_US.UTF-8
export LANG=en_US.UTF-8

# colored
export CLICOLOR_FORCE=1
export CLICOLOR=1
export TERM=xterm-color

# ftw.upgrade
export UPGRADE_AUTHENTICATION=admin:admin

# OpenSSL
export CPPFLAGS="${CPPFLAGS} -I$(brew --prefix openssl)/include"
export LDFLAGS="${LDFLAGS} -L$(brew --prefix openssl)/lib"
export PATH="/usr/local/opt/openssl/bin:$PATH"

# pyenv and pyenv-virtualenvwrapper (von Joni)
hash pyenv 2>/dev/null && eval "$(pyenv init -)" && eval "$(pyenv virtualenv-init -)" && export PYTHON_CONFIGURE_OPTS="--enable-optimizations"

# pyenv activate by workon function
workon(){source $(pyenv root)/versions/"$1"/bin/activate}
compctl -/ -W $(pyenv root)/versions/ workon

# **********************************
# export NVM_DIR="$HOME/.nvm"
# . "$(brew --prefix nvm)/nvm.sh"
# **********************************
# lazy load nvm (on navigating into dir with .nvmrc)
function load-nvm () {
  if [[ $OSTYPE == "darwin"* ]]; then
    export NVM_DIR=~/.nvm
    [[ -s $(brew --prefix nvm)/nvm.sh ]] && source $(brew --prefix nvm)/nvm.sh
  else
    [[ -s "$HOME/.nvm/nvm.sh" ]] && source "$HOME/.nvm/nvm.sh"
  fi
}

load-nvmrc() {
  if [[ -f .nvmrc && -r .nvmrc ]]; then
    if ! type nvm >/dev/null; then
      load-nvm
    fi
    nvm use
  fi
}
add-zsh-hook chpwd load-nvmrc

# Add Ruby path
if which rbenv > /dev/null; then eval "$(rbenv init -)"; fi

# Add python and pdb config
export PYTHONSTARTUP=$HOME/.pythonrc

# Java
export JUNIT_HOME="$HOME/bin/java"
export PATH="$PATH:$JUNIT_HOME"
export CLASSPATH="$CLASSPATH:$JUNIT_HOME/junit-4.13-beta-2.jar:$JUNIT_HOME/hamcrest-core-2.1.jar"

# Dots to "Path" from Jone
rationalise-dot() {
    if [[ $LBUFFER != g* && $LBUFFER = *.. ]]; then
        LBUFFER+=/..
    else
        LBUFFER+=.
    fi
}
zle -N rationalise-dot
bindkey . rationalise-dot
